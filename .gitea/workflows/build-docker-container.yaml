name: RELEASE-DOCKER-CONTAINER
run-name: ${{ gitea.actor }} building and pushing docker container
on:
  workflow_dispatch:
  push:
    branches:
      - master

jobs:
  build-docker:
    runs-on: ubuntu-latest
    steps:
      - name: CHECK-OUT
        uses: actions/checkout@v4
      - name: Extract version from package.json
        uses: sergeysova/jq-action@v2
        id: version
        with:
          cmd: "jq .version package.json -r"
      # - name: LOGIN TO RASPI DOCKER
      #   uses: docker/login-action@v3
      #   with:
      #     registry: raspi4:6363
      #     username: ${{ vars.CONTAINER_REGISTRY_USERNAME }}
      #     password: ${{ secrets.CONTAINER_REGISTRY_PASSWORD }}
      # - name: BUILD DOCKER IMAGE
      #   uses: docker/build-push-action@v6
      #   with:
      #     push: true
      #     tags: raspi4:6363/${{ vars.CONTAINER_REGISTRY_USERNAME }}/assets #${{ env.BUILD_TAG }}
      - name: LOGIN TO GITHUB DOCKER
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: venil7
          password: ${{ secrets.GTHB_CR_TOKEN }}
      - name: BUILD DOCKER IMAGE AND PUSH TO GIHUB
        uses: docker/build-push-action@v6
        with:
          push: true
          tags: ghcr.io/venil7/assets:${{ steps.version.outputs.value }}
